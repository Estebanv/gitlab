{
  "name": "Gitlab",
  "tagline": "Stack de contenedores de Gitlab",
  "body": "# Gitlab\r\n\r\nPersonalizacion del yml del repositorio [sameersbn/docker-gitlab](https://github.com/sameersbn/docker-gitlab), para instalar el gilab en al unlu.\r\n\r\nObviamente se requiere el docker-compose.\r\n\r\nSolo hace falta ejecutar `docker-compose -p gitlab up -d`.\r\n\r\nLa la URL esta configurada en gitlab como `gitlab.unlu.edu.ar`. Editar el archivo hosts con los valores que corresponda.\r\n\r\n## Administración\r\n\r\nPara el upgrade hay que tener en cuenta las 2 fases básicas (siempre y cuando se este usando la personalización de la imgen base).\r\n\r\n### Fase 1\r\n\r\nEstos pasos se realizan en la maquina que tenga la personalizacion (Con este repo clonado, obviamente).\r\n\r\nSe pullea la nueva imagen y se edita el dockerfile:\r\n\r\n```\r\ndocker pull sameersbn/gitlab:X.X.X # Donde X.X.X es la ultima version de la imagen\r\nmcedit Dockerfile # Cambiar la imagen a la nueva version X.X.X\r\n```\r\n\r\nSe buildea con las opciones que sean necesarias (se incluyeron las mas importantes para usar dentro de la UNLu):\r\n\r\n```\r\ndocker build --build-arg http_proxy=http://proxy.unlu.edu.ar:8080 -t estebanv/gitlab:v1 .\r\ndocker push estebanv/gitlab:v1\r\n```\r\n\r\nSe commitea y pushea contra github:\r\n\r\n```\r\ngit commit -a -m 'Actualizada la imagen de gitlab de X.X.X a Y.Y.Y'\r\ngit push origin master\r\n```\r\n\r\n### Fase 2\r\n\r\nEn el server:\r\n\r\nPrimero hacer el backup:\r\n\r\nLo mejor es loguearse al contenedor de gitlab (docker exec -it gitlab bash). Los comandos son (back y restore):\r\n\r\n```\r\nsudo -HEu git bundle exec rake gitlab:backup:create RAILS_ENV=production\r\nsudo -HEu git bundle exec rake gitlab:backup:restore RAILS_ENV=production\r\n```\r\n\r\nActualizar la imagen personalizada:\r\n\r\n```\r\ndocker pull estebanv/gitlab:v1\r\n```\r\n\r\nDetener y eliminar los containers del stack (podria ser solo el de gitlab, pero no se podria usar docker-compose):\r\n\r\n```\r\ndocker-compose -p gitlab stop\r\ndocker-compose -p gitlab rm --all\r\n```\r\n\r\nEditar el yml para poner la nueva imagen si fuera necesario (la nuestra se llama igual por el momento) y levantar el contenedor/stack segun corresponda:\r\n\r\n```\r\nmcedit docker-compose.yml\r\ndocker-compose -p gitlab up -d\r\n```\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}